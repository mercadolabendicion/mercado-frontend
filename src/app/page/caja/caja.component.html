<div class="contenedor">
  <!-- Header -->
  <div class="cash-header">
    <div>
      <h1 class="cash-title">Gestión de caja</h1>
      <p class="cash-subtitle">Administra tus ingresos y egresos en tiempo real</p>
    </div>
  </div>

  <!-- Summary Cards -->
  <div class="summary-grid">
    <!-- Ingresos Card -->
    <div class="summary-card">
      <div class="card-header">
        <span class="card-label">Ingresos</span>
        <div class="icon-circle icon-green">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 19V5M5 12l7-7 7 7" />
          </svg>
        </div>
      </div>
      <div class="card-amount">{{ ingresos | currency : "USD" : "symbol" : "1.0-0" }}</div>
      <div class="card-description">Total de ingresos del día</div>
    </div>

    <!-- Egresos Card -->
    <div class="summary-card">
      <div class="card-header">
        <span class="card-label">Egresos</span>
        <div class="icon-circle icon-red">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12l7 7 7-7" />
          </svg>
        </div>
      </div>
      <div class="card-amount">{{ egresos | currency : "USD" : "symbol" : "1.0-0" }}</div>
      <div class="card-description">Total de egresos del día</div>
    </div>

    <!-- Saldo Actual Card -->
    <div class="summary-card summary-card-highlight">
      <div class="card-header">
        <span class="card-label">Saldo Caja Mayor</span>
        <div class="icon-circle icon-blue">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="5" width="20" height="14" rx="2" />
            <path d="M2 10h20" />
          </svg>
        </div>
      </div>
      <div class="card-amount card-amount-large">{{ saldo | currency : "USD" : "symbol" : "1.0-0" }}</div>
      <div class="card-description">Balance disponible en caja mayor</div>
    </div>
  </div>

  <!-- Historial Caja Menor -->
  <div class="transactions-section">
    <div class="section-header">
      <div>
        <h2 class="section-title">Historial de cierres de caja menor</h2>
        <p class="section-subtitle">Registro detallado de cierres de caja menor</p>
      </div>
      <span class="records-badge">{{ registrosCajaMenor.length }} registros</span>
    </div>

    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>Fecha y hora</th>
              <th>Valor de cierre</th>
              <th>Restante</th>
              <th>Usuario</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let registro of registrosCajaMenor">
              <td>{{ formatearFecha(registro.fechaHoraCierre) }}</td>
              <td>
                <span class="amount-cell amount-income">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" />
                  </svg>
                  {{ registro.valorCierre | currency : "USD" : "symbol" : "1.0-0" }}
                </span>
              </td>
              <td class="amount-bold">{{ registro.restante | currency : "USD" : "symbol" : "1.0-0" }}</td>
              <td>{{ registro.nombreUsuario }}</td>
            </tr>
            <tr *ngIf="registrosCajaMenor.length === 0">
              <td colspan="4" class="empty-state">No hay registros de caja menor</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Paginación Caja Menor -->
    <div class="d-flex justify-content-center align-items-center mt-3 flex-wrap" *ngIf="registrosCajaMenor.length > 0">
      <nav aria-label="Page navigation" class="w-100">
        <ul class="pagination justify-content-center mt-3 flex-wrap">

          <!-- Botón Anterior -->
          <li class="page-item" [class.disabled]="paginaActualMenor === 0">
            <button class="page-link d-flex align-items-center gap-1" (click)="paginaAnteriorMenor()" tabindex="-1"
              aria-disabled="true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6" />
              </svg>
              Anterior
            </button>
          </li>

          <!-- Indicador de página -->
          <li class="page-item active">
            <button class="page-link">
              {{ paginaActualMenor + 1 }}
            </button>
          </li>

          <!-- Botón Siguiente -->
          <li class="page-item" [class.disabled]="!tieneMasRegistrosMenor">
            <button class="page-link d-flex align-items-center gap-1" (click)="paginaSiguienteMenor()">
              Siguiente
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6" />
              </svg>
            </button>
          </li>

        </ul>
      </nav>
    </div>

  </div>


  <!-- Historial Caja Mayor -->
  <div class="transactions-section">
    <div class="section-header">
      <div>
        <h2 class="section-title">Historial de cierres de caja mayor</h2>
        <p class="section-subtitle">Registro detallado de cierres de caja mayor</p>
      </div>
      <span class="records-badge">{{ registrosCajaMayor.length }} registros</span>
    </div>

    <div class="table-container">
      <div class="table-responsive">
        <table class="table table-bordered table-hover">
          <thead>
            <tr>
              <th>Fecha y hora</th>
              <th>Valor de cierre</th>
              <th>Restante</th>
              <th>Usuario</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let registro of registrosCajaMayor">
              <td>{{ formatearFecha(registro.fechaHoraCierre) }}</td>
              <td>
                <span class="amount-cell amount-income">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6" />
                  </svg>
                  {{ registro.valorCierre | currency : "USD" : "symbol" : "1.0-0" }}
                </span>
              </td>
              <td class="amount-bold">{{ registro.restante | currency : "USD" : "symbol" : "1.0-0" }}</td>
              <td>{{ registro.nombreUsuario }}</td>
            </tr>
            <tr *ngIf="registrosCajaMayor.length === 0">
              <td colspan="4" class="empty-state">No hay registros de caja mayor</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Paginación Caja Mayor -->
    <div class="d-flex justify-content-center align-items-center mt-3 flex-wrap" *ngIf="registrosCajaMayor.length > 0">
      <nav aria-label="Page navigation" class="w-100">
        <ul class="pagination justify-content-center mt-3 flex-wrap">

          <!-- Botón Anterior -->
          <li class="page-item" [class.disabled]="paginaActualMayor === 0">
            <button class="page-link d-flex align-items-center gap-1" (click)="paginaAnteriorMayor()" tabindex="-1"
              aria-disabled="true">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6" />
              </svg>
              Anterior
            </button>
          </li>

          <!-- Indicador de página -->
          <li class="page-item active">
            <button class="page-link">
              {{ paginaActualMayor + 1 }}
            </button>
          </li>

          <!-- Botón Siguiente -->
          <li class="page-item" [class.disabled]="!tieneMasRegistrosMayor">
            <button class="page-link d-flex align-items-center gap-1" (click)="paginaSiguienteMayor()">
              Siguiente
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 18l6-6-6-6" />
              </svg>
            </button>
          </li>

        </ul>
      </nav>
    </div>

  </div>

  <!-- Action Buttons -->
  <div class="actions-footer">
    <button class="btn-lg w-100" id="gris">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        <path d="M9 10a3 3 0 016 0v5" />
        <path d="M9 16h6" />
      </svg>
      Consultar valor del negocio
    </button>

    <button class="btn-lg w-100" id="amarillo" (click)="mostrarModalPasarCajaMenor()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M7 16V4M7 4L3 8M7 4l4 4" />
        <path d="M17 8v12m0 0l4-4m-4 4l-4-4" />
      </svg>
      Pasar a caja menor
    </button>

    <button class="btn-lg w-100" id="rojo" (click)="mostrarModalCerrarCaja()">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M18 6L6 18M6 6l12 12" />
      </svg>
      Cerrar caja mayor
    </button>
  </div>
</div>

<!-- Modal Cerrar Caja Mayor (Bootstrap markup, vertically centered) -->
<div class="modal fade" id="cerrarCajaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cerrar caja mayor</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="ocultarModal('cerrarCajaModal')"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <div class="cierre-valor-input">
              <label for="valorCierre" class="cierre-input-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="20" height="14" x="2" y="5" rx="2" />
                  <line x1="2" x2="22" y1="10" y2="10" />
                </svg>
                Valor de cierre de caja mayor:
              </label>
              <input type="text" class="form-control" id="valorCierre" [value]="valorCierreFormateado"
                (input)="formatearValorCierre($event)" placeholder="Ingrese el valor de cierre" />
            </div>
          </div>
        </form>
        <p class="cierre-warning">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
            <line x1="12" x2="12" y1="9" y2="13" />
            <line x1="12" x2="12.01" y1="17" y2="17" />
          </svg>
          Al confirmar, se cerrará la caja mayor. Recuerde que esta opción solo se usa
          cuando el dinero sale por completo del negocio. Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="cerrarCaja()">
          Cerrar caja mayor
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Pasar a Caja Menor (Bootstrap markup, vertically centered) -->
<div class="modal fade" id="pasarCajaMenorModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Pasar a caja menor</h5>
        <button type="button" class="btn-close" aria-label="Close"
          (click)="ocultarModal('pasarCajaMenorModal')"></button>
      </div>
      <div class="modal-body">
        <div class="info-box"
          style="background-color: #e3f2fd; padding: 12px; border-radius: 8px; margin-bottom: 16px;">
          <p style="margin: 0; color: #1976d2; font-size: 14px;">
            <strong>Saldo disponible en caja mayor:</strong> {{ saldo | currency : "USD" : "symbol" : "1.0-0" }}
          </p>
        </div>
        <form>
          <div class="form-group">
            <label for="valorPaso">Valor a transferir:</label>
            <input type="text" class="form-control" id="valorPaso" [value]="valorPasoFormateado"
              (input)="formatearValorPaso($event)" placeholder="Ingrese el valor a transferir" />
            <small class="form-text text-muted">Este valor se restará de caja mayor y se sumará a caja menor</small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="pasarACajaMenor()">
          Transferir a caja menor
        </button>
      </div>
    </div>
  </div>
</div>
