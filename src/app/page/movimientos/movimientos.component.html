<div class="contenedor">
  <div class="row">
    <div class="col-12 col-md-6">
      <h1>Gestión de movimientos</h1>
      <p>Administre aquí los ingresos y egresos del negocio</p>
    </div>
    <div class="col-12 col-md-6">
      <div class="row">
        <!-- Tarjetas de resumen con diseño moderno -->
        <div class="summary-cards">
          <div class="summary-card ventas">
            <div class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
              </svg>
            </div>
            <div class="card-content">
              <p class="card-label">Ventas</p>
              <h3 class="card-value">{{ totalVentas | currency : "USD" : "symbol" : "1.0-0" }}</h3>
            </div>
          </div>

          <div class="summary-card efectivo">
            <div class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="14" x="2" y="5" rx="2" />
                <line x1="2" x2="22" y1="10" y2="10" />
              </svg>
            </div>
            <div class="card-content">
              <p class="card-label">Movimientos</p>
              <h3 class="card-value">{{ totalEfectivo | currency : "USD" : "symbol" : "1.0-0" }}</h3>
            </div>
          </div>

          <div class="summary-card externo">
            <div class="card-icon">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 12V7H5a2 2 0 0 1 0-4h14v4" />
                <path d="M3 5v14a2 2 0 0 0 2 2h16v-5" />
                <path d="M18 12a2 2 0 0 0 0 4h4v-4Z" />
              </svg>
            </div>
            <div class="card-content">
              <p class="card-label">En la caja menor</p>
              <h3 class="card-value">{{ saldoCajaMenor | currency : "USD" : "symbol" : "1.0-0" }}</h3>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row align-items-center">
    <div class="col-12 col-md-6">
      <div class="row">
        <div class="col-12 col-md-6 mt-2">
          <button class="btn-lg w-100" id="verde" (click)="mostrarModal('ingreso')">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 19V5M5 12l7-7 7 7" />
            </svg>
            Agregar ingreso
          </button>
        </div>
        <div class="col-12 col-md-6 col-lg-6 mt-2">
          <button class="btn-lg w-100" id="naranja" (click)="mostrarModal('egreso')">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 5v14M5 12l7 7 7-7" />
            </svg>
            Agregar egreso
          </button>
        </div>
      </div>
    </div>
    <div class="col-12 col-md-6">
      <div class="d-flex justify-content-end w-100">
        <div class="filter-input-group d-flex align-items-center mt-4">
          <label for="fechaFiltro" class="filter-label mb-0">
            Filtrar por fecha:
          </label>
          <input type="date" class="filter-input" id="fechaFiltro" [(ngModel)]="fechaFiltro"
            (ngModelChange)="onFechaChange()" />
        </div>
      </div>
    </div>
  </div>

  <p class="filter-info">Mostrando movimientos del: <strong>{{ fechaFiltro | date: 'dd/MM/yyyy' }}</strong></p>

  <div class="table-container">
    <div class="table-responsive">
      <table class="table table-bordered table-hover">
        <thead>
          <tr>
            <th>Fecha y Hora</th>
            <th>Motivo</th>
            <th>Valor</th>
            <th>Tipo</th>
            <th class="actions-header">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let movimiento of movimientosFiltrados; let i = index">
            <td>{{ movimiento.fechaHora }}</td>
            <td>{{ movimiento.motivo }}</td>
            <td class="valor-cell">{{ movimiento.valor | currency : "USD" : "symbol" : "1.0-0" }}</td>
            <td>
              <span class="badge" [ngClass]="{
                'badge-ingreso': movimiento.tipo === 'Ingreso',
                'badge-egreso': movimiento.tipo === 'Egreso'
              }">
                {{ movimiento.tipo }}
              </span>
            </td>
            <td>
              <div class="action-buttons-cell">
                <button class="btn-icon btn-delete" (click)="eliminarMovimiento(movimiento)" title="Eliminar">
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 6h18" />
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" />
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" />
                    <line x1="10" x2="10" y1="11" y2="17" />
                    <line x1="14" x2="14" y1="11" y2="17" />
                  </svg>
                </button>
              </div>
            </td>
          </tr>
          <tr *ngIf="movimientosFiltrados.length === 0">
            <td colspan="5" class="empty-state">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10" />
                <path d="M12 6v6l4 2" />
              </svg>
              <p>No hay movimientos para la fecha seleccionada</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="row align-items-center mt-3">
    <div class="col-12 col-md-3 mt-2">
      <button class="btn-lg w-100" id="gris" (click)="generarReporte()">
        Generar reporte
      </button>
    </div>
    <div class="col-12 col-md-3">
    </div>
    <div class="col-12 col-md-3">
    </div>
    <div class="col-12 col-md-3 mt-2">
      <button class="btn-lg w-100" id="rojo" (click)="mostrarModalCierreCaja()">
        Cerrar caja menor
      </button>
    </div>
  </div>
</div>

<!-- Modal para Agregar/Editar (Bootstrap modal) -->
<div class="modal fade" id="ingresoModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ modalTitle }}</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="ocultarModal()"></button>
      </div>
      <div class="modal-body">
        <form>
          <div class="form-group">
            <label for="valor">Valor:</label>
            <input type="text" class="form-control" id="valor" [value]="valorFormateado"
              (input)="formatearValor($event)" />
          </div>

          <div class="form-group">
            <label for="motivo">Motivo:</label>
            <textarea class="form-control" id="motivo"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" (click)="procesarTransaccion()">{{ actionButtonText }}</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Cierre de Caja Menor (Bootstrap modal) -->
<div class="modal fade" id="cierreCajaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Resumen de cierre de caja</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="ocultarModalCierreCaja()"></button>
      </div>
      <div class="modal-body">
        <div class="cierre-summary">
          <div class="cierre-item">
            <div class="cierre-label">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />
              </svg>
              <span>Total ventas:</span>
            </div>
            <div class="cierre-value">{{ totalVentasCierre | currency : "USD" : "symbol" : "1.0-0" }}</div>
          </div>

          <div class="cierre-item egreso">
            <div class="cierre-label">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 5v14M5 12l7 7 7-7" />
              </svg>
              <span>Total egresos:</span>
            </div>
            <div class="cierre-value">{{ totalEgresosCierre | currency : "USD" : "symbol" : "1.0-0" }}</div>
          </div>

          <div class="cierre-item ingreso">
            <div class="cierre-label">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 19V5M5 12l7-7 7 7" />
              </svg>
              <span>Total ingresos (ingresos + ventas):</span>
            </div>
            <div class="cierre-value">{{ totalIngresosCierre | currency : "USD" : "symbol" : "1.0-0" }}</div>
          </div>

          <div class="cierre-divider"></div>

          <div class="cierre-item total">
            <div class="cierre-label">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect width="20" height="14" x="2" y="5" rx="2" />
                <line x1="2" x2="22" y1="10" y2="10" />
              </svg>
              <span>Saldo final (valor en la caja):</span>
            </div>
            <div class="cierre-value">{{ saldoCajaMenor | currency : "USD" : "symbol" : "1.0-0" }}</div>
          </div>
        </div>

        <div class="cierre-valor-input">
          <label for="valorCierre" class="cierre-input-label">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect width="20" height="14" x="2" y="5" rx="2" />
              <line x1="2" x2="22" y1="10" y2="10" />
            </svg>
            Valor de cierre de caja:
          </label>
          <input type="text" class="form-control cierre-input" id="valorCierre" [value]="valorCierreFormateado"
            (input)="formatearValorCierre($event)" placeholder="Ingrese el valor de cierre" />
        </div>

        <p class="cierre-warning">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" />
            <line x1="12" x2="12" y1="9" y2="13" />
            <line x1="12" x2="12.01" y1="17" y2="17" />
          </svg>
          Al confirmar, se cerrará la caja menor. Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-lg w-100" id="gris" (click)="ocultarModalCierreCaja()">Cancelar</button>
        <button type="button" class="btn-lg w-100" id="rojo" (click)="confirmarCierreCaja()">Cerrar caja menor</button>
      </div>
    </div>
  </div>
</div>
